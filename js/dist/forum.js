(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>I,extend:()=>T,utils:()=>N});const s=flarum.core.compat["forum/app"];var o=t.n(s);const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/states/DiscussionListState"];var i=t.n(r);const c=flarum.core.compat["forum/components/DiscussionListItem"];var a=t.n(c);function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}const u=flarum.core.compat["common/Component"];var l=t.n(u);const h=flarum.core.compat["common/utils/string"];function f(t,e){var s=(new DOMParser).parseFromString(t,"text/html"),o=function(t){0!==e?t.nodeType!==Node.TEXT_NODE?Array.from(t.childNodes).forEach(o):t.textContent.length<e?e-=t.textContent.length:(t.textContent=t.textContent.substring(0,e)+"...",e=0):t.parentNode.removeChild(t)};return o(s.body),s.body.innerHTML}var d=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).post=void 0,e.length=void 0,e.richExcerpt=void 0,e}var s,o;o=t,(s=e).prototype=Object.create(o.prototype),s.prototype.constructor=s,p(s,o);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.post=this.attrs.post,this.length=this.attrs.length,this.richExcerpt=this.attrs.richExcerpt},n.view=function(){return m("div",{className:"Synopsis-excerpt"},this.getContent())},n.getContent=function(){var t,e;return this.richExcerpt?m.trust(f(null!=(e=this.contentRich())?e:"",this.length)):(0,h.truncate)(null!=(t=this.contentPlain())?t:"",this.length)},n.contentRich=function(){return this.post.contentHtml()},n.contentPlain=function(){return this.post.contentPlain()},e}(l());const y=flarum.core.compat["forum/components/SettingsPage"];var x=t.n(y);const v=flarum.core.compat["common/components/FieldSet"];var g=t.n(v);const b=flarum.core.compat["common/utils/ItemList"];var S=t.n(b);const w=flarum.core.compat["common/components/Switch"];var E=t.n(w);const O=flarum.core.compat["common/utils/Stream"];var P=t.n(O);const M=flarum.core.compat["common/extenders"];var _=t.n(M);const L=flarum.core.compat["tags/common/models/Tag"];var C=t.n(L);const j=[new(_().Model)(C()).attribute("richExcerpts").attribute("excerptLength")],T=[].concat(j);var I={Excerpt:d},N={truncateHtml:f};o().initializers.add("fof-synopsis",(function(){(0,n.extend)(i().prototype,"requestParams",(function(t){"string"==typeof t.include?t.include=[t.include]:t.include=t.include||[],"first"===o().forum.attribute("synopsis.excerpt_type")?t.include.push("firstPost"):t.include.push("lastPost")})),(0,n.extend)(a().prototype,"infoItems",(function(t){var e,s,n,r,i,c;if(!o().forum.attribute("synopsis.disable_when_searching")||!o().discussions.params.q){var a=this.attrs.discussion;if(!o().session.user||null!=(e=o().session.user.preferences())&&e.showSynopsisExcerpts){var p,u=a.tags();u&&(p=u[u.length-1]);var l="first"===o().forum.attribute("synopsis.excerpt_type")?a.firstPost():a.lastPost(),h="number"==typeof(null==(s=p)?void 0:s.excerptLength())?null==(n=p)?void 0:n.excerptLength():o().forum.attribute("synopsis.excerpt_length"),f="number"==typeof(null==(r=p)?void 0:r.richExcerpts())?null==(i=p)?void 0:i.richExcerpts():o().forum.attribute("synopsis.rich_excerpts"),y=!!o().session.user&&(null==(c=o().session.user.preferences())?void 0:c.showSynopsisExcerptsOnMobile);if(0!==h&&l){var x=m(d,{post:l,length:h,richExcerpt:f});t.add("excerpt",x,-100),y&&t.add("excerptM",x,-100)}}}})),(0,n.extend)(x().prototype,"oninit",(function(){var t,e;this.showSynopsisExcerpts=P()(null==(t=this.user)||null==(t=t.preferences())?void 0:t.showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=P()(null==(e=this.user)||null==(e=e.preferences())?void 0:e.showSynopsisExcerptsOnMobile)})),(0,n.extend)(x().prototype,"settingsItems",(function(t){t.add("synopsis",g().component({label:o().translator.trans("fof-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),x().prototype.summariesItems=function(){var t=this,e=new(S());if(!this.user)return e;var s=this.user.preferences();return e.add("synopsis-excerpts",E().component({state:null==s?void 0:s.showSynopsisExcerpts,onchange:function(e){var s;t.showSynopsisExcerptsLoading=!0,null==(s=t.user)||s.savePreferences({showSynopsisExcerpts:e}).then((function(){t.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},o().translator.trans("fof-synopsis.forum.user.settings.show-summaries"))),null!=s&&s.showSynopsisExcerpts&&e.add("synopsis-excerpts-mobile",E().component({state:null==s?void 0:s.showSynopsisExcerptsOnMobile,disabled:!(null!=s&&s.showSynopsisExcerpts),onchange:function(e){var s;t.showSynopsisExcerptsOnMobileLoading=!0,null==(s=t.user)||s.savePreferences({showSynopsisExcerptsOnMobile:e}).then((function(){t.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},o().translator.trans("fof-synopsis.forum.user.settings.show-summaries-mobile"))),e}}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map