{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/synopsis/webpack/bootstrap","webpack://@fof/synopsis/webpack/runtime/compat get default export","webpack://@fof/synopsis/webpack/runtime/define property getters","webpack://@fof/synopsis/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/synopsis/webpack/runtime/make namespace object","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'forum/app')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'forum/states/DiscussionListState')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'forum/components/DiscussionListItem')\"","webpack://@fof/synopsis/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://@fof/synopsis/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://@fof/synopsis/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://@fof/synopsis/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/utils/string')\"","webpack://@fof/synopsis/./src/forum/utils/truncateHtml.ts","webpack://@fof/synopsis/./src/forum/components/Excerpt.tsx","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/components/FieldSet')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/utils/ItemList')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/components/Switch')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/utils/Stream')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('core', 'common/extenders')\"","webpack://@fof/synopsis/external root \"flarum.reg.get('flarum-tags', 'common/models/Tag')\"","webpack://@fof/synopsis/./src/common/extend.ts","webpack://@fof/synopsis/./src/forum/extend.ts","webpack://@fof/synopsis/./src/forum/components/index.ts","webpack://@fof/synopsis/./src/forum/utils/index.ts","webpack://@fof/synopsis/./src/forum/index.ts","webpack://@fof/synopsis/./src/forum/addSummaryExcerpt.tsx","webpack://@fof/synopsis/./src/forum/addUserPreference.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/app');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/states/DiscussionListState');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/DiscussionListItem');","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/Component');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/utils/string');","/**\n * Safely truncate an HTML string without breaking opening/closing tags\n * Only characters in text nodes count towards the length\n * @param html\n * @param length\n */\nexport default function (html, length) {\n  const parser = new DOMParser().parseFromString(html, 'text/html');\n\n  // Safe HTML truncation\n  // Loop through every node and shorten text nodes once the length is reached\n  // After reaching the limit, start deleting other children we come across\n  const truncateNode = node => {\n    if (length === 0) {\n      node.parentNode.removeChild(node);\n      return;\n    }\n    if (node.nodeType === Node.TEXT_NODE) {\n      if (node.textContent.length < length) {\n        length -= node.textContent.length;\n      } else {\n        node.textContent = node.textContent.substring(0, length) + '...';\n        length = 0;\n      }\n      return;\n    }\n\n    // Need to create copy of the node list otherwise the loop gets messed up when a node is deleted\n    Array.from(node.childNodes).forEach(truncateNode);\n  };\n  truncateNode(parser.body);\n  return parser.body.innerHTML;\n}","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport Component from 'flarum/common/Component';\nimport { truncate } from 'flarum/common/utils/string';\nimport truncateHtml from '../utils/truncateHtml';\nexport default class Excerpt extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"post\", void 0);\n    _defineProperty(this, \"length\", void 0);\n    _defineProperty(this, \"richExcerpt\", void 0);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.post = this.attrs.post;\n    this.length = this.attrs.length;\n    this.richExcerpt = this.attrs.richExcerpt;\n  }\n  view() {\n    return m(\"div\", {\n      className: \"Synopsis-excerpt\"\n    }, this.getContent());\n  }\n  getContent() {\n    var _this$contentPlain;\n    if (this.richExcerpt) {\n      var _this$contentRich;\n      return m.trust(truncateHtml((_this$contentRich = this.contentRich()) != null ? _this$contentRich : '', this.length));\n    }\n    return truncate((_this$contentPlain = this.contentPlain()) != null ? _this$contentPlain : '', this.length);\n  }\n  contentRich() {\n    return this.post.contentHtml();\n  }\n  contentPlain() {\n    return this.post.contentPlain();\n  }\n}\nflarum.reg.add('fof-synopsis', 'forum/components/Excerpt', Excerpt);","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/FieldSet');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/utils/ItemList');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Switch');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/utils/Stream');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extenders');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('flarum-tags', 'common/models/Tag');","import Extend from 'flarum/common/extenders';\nimport Tag from 'ext:flarum/tags/common/models/Tag';\nexport default [new Extend.Model(Tag) //\n.attribute('richExcerpts').attribute('excerptLength')];","import commonExtend from '../common/extend';\nexport default [...commonExtend];","import Excerpt from './Excerpt';\nexport const components = {\n  Excerpt\n};\nflarum.reg.add('fof-synopsis', 'forum/components', null);","import truncateHtml from './truncateHtml';\nexport const utils = {\n  truncateHtml\n};\nflarum.reg.add('fof-synopsis', 'forum/utils', null);","import app from 'flarum/forum/app';\nimport addSummaryExcerpt from './addSummaryExcerpt';\nimport addUserPreference from './addUserPreference';\nexport { default as extend } from './extend';\nexport * from './components';\nexport * from './utils';\napp.initializers.add('fof-synopsis', () => {\n  addSummaryExcerpt();\n  addUserPreference();\n});","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport Excerpt from './components/Excerpt';\nexport default function addSummaryExcerpt() {\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\n    if (typeof params.include === 'string') {\n      params.include = [params.include];\n    } else {\n      params.include = params.include || [];\n    }\n    if (app.forum.attribute('synopsis.excerpt_type') === 'first') {\n      params.include.push('firstPost');\n    } else {\n      params.include.push('lastPost');\n    }\n  });\n  extend(DiscussionListItem.prototype, 'infoItems', function (items) {\n    var _app$session$user$pre, _tag, _tag2, _tag3, _tag4, _app$session$user$pre2;\n    const discussion = this.attrs.discussion;\n    if (app.session.user && !((_app$session$user$pre = app.session.user.preferences()) != null && _app$session$user$pre.showSynopsisExcerpts)) {\n      return;\n    }\n    const tags = discussion.tags();\n    let tag;\n    if (tags) {\n      tag = tags[tags.length - 1];\n    }\n    const excerptPost = app.forum.attribute('synopsis.excerpt_type') === 'first' ? discussion.firstPost() : discussion.lastPost();\n    const excerptLength = typeof ((_tag = tag) == null ? void 0 : _tag.excerptLength()) === 'number' ? (_tag2 = tag) == null ? void 0 : _tag2.excerptLength() : app.forum.attribute('synopsis.excerpt_length');\n    const richExcerpt = typeof ((_tag3 = tag) == null ? void 0 : _tag3.richExcerpts()) === 'number' ? (_tag4 = tag) == null ? void 0 : _tag4.richExcerpts() : app.forum.attribute('synopsis.rich_excerpts');\n    const onMobile = app.session.user ? (_app$session$user$pre2 = app.session.user.preferences()) == null ? void 0 : _app$session$user$pre2.showSynopsisExcerptsOnMobile : false;\n\n    // A length of zero means we don't want a synopsis for this discussion, so do nothing.\n    if (excerptLength === 0) {\n      return;\n    }\n    if (excerptPost) {\n      const excerpt = m(Excerpt, {\n        post: excerptPost,\n        length: excerptLength,\n        richExcerpt: richExcerpt\n      });\n      items.add('excerpt', excerpt, -100);\n      onMobile && items.add('excerptM', excerpt, -100);\n    }\n  });\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Switch from 'flarum/common/components/Switch';\nimport Stream from 'flarum/common/utils/Stream';\nexport default function () {\n  extend('flarum/forum/components/SettingsPage', 'oninit', function () {\n    var _this$user, _this$user2;\n    this.showSynopsisExcerpts = Stream((_this$user = this.user) == null || (_this$user = _this$user.preferences()) == null ? void 0 : _this$user.showSynopsisExcerpts);\n    this.showSynopsisExcerptsOnMobile = Stream((_this$user2 = this.user) == null || (_this$user2 = _this$user2.preferences()) == null ? void 0 : _this$user2.showSynopsisExcerptsOnMobile);\n  });\n  extend('flarum/forum/components/SettingsPage', 'settingsItems', function (items) {\n    items.add('synopsis', FieldSet.component({\n      label: app.translator.trans('fof-synopsis.forum.user.settings.summaries-heading'),\n      className: 'Settings-Synopsis'\n    }, this.summariesItems().toArray()));\n  });\n  extend('flarum/forum/components/SettingsPage', 'summariesItems', function () {\n    const items = new ItemList();\n    if (!this.user) return items;\n    const prefs = this.user.preferences();\n    items.add('synopsis-excerpts', Switch.component({\n      state: prefs == null ? void 0 : prefs.showSynopsisExcerpts,\n      onchange: value => {\n        var _this$user3;\n        this.showSynopsisExcerptsLoading = true;\n        (_this$user3 = this.user) == null || _this$user3.savePreferences({\n          showSynopsisExcerpts: value\n        }).then(() => {\n          this.showSynopsisExcerptsLoading = false;\n          m.redraw();\n        });\n      },\n      loading: this.showSynopsisExcerptsLoading\n    }, app.translator.trans('fof-synopsis.forum.user.settings.show-summaries')));\n    if (prefs != null && prefs.showSynopsisExcerpts) {\n      items.add('synopsis-excerpts-mobile', Switch.component({\n        state: prefs == null ? void 0 : prefs.showSynopsisExcerptsOnMobile,\n        disabled: !(prefs != null && prefs.showSynopsisExcerpts),\n        onchange: value => {\n          var _this$user4;\n          this.showSynopsisExcerptsOnMobileLoading = true;\n          (_this$user4 = this.user) == null || _this$user4.savePreferences({\n            showSynopsisExcerptsOnMobile: value\n          }).then(() => {\n            this.showSynopsisExcerptsOnMobileLoading = false;\n            window.location.reload();\n          });\n        },\n        loading: this.showSynopsisExcerptsOnMobileLoading\n      }, app.translator.trans('fof-synopsis.forum.user.settings.show-summaries-mobile')));\n    }\n    return items;\n  });\n}"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","reg","_typeof","iterator","constructor","_defineProperty","e","r","t","i","toPrimitive","TypeError","String","toPropertyKey","configurable","writable","html","length","parser","DOMParser","parseFromString","truncateNode","node","nodeType","Node","TEXT_NODE","Array","from","childNodes","forEach","textContent","substring","parentNode","removeChild","body","innerHTML","Excerpt","super","arguments","this","oninit","vnode","post","attrs","richExcerpt","view","m","className","getContent","_this$contentPlain","_this$contentRich","trust","truncateHtml","contentRich","truncate","contentPlain","contentHtml","add","attribute","components","utils","extend","params","include","push","items","_app$session$user$pre","_tag","_tag2","_tag3","_tag4","_app$session$user$pre2","discussion","user","preferences","showSynopsisExcerpts","tags","tag","excerptPost","firstPost","lastPost","excerptLength","richExcerpts","onMobile","showSynopsisExcerptsOnMobile","excerpt","_this$user","_this$user2","label","trans","summariesItems","toArray","prefs","state","onchange","_this$user3","showSynopsisExcerptsLoading","savePreferences","then","redraw","loading","disabled","_this$user4","showSynopsisExcerptsOnMobileLoading","window","location","reload"],"sourceRoot":""}