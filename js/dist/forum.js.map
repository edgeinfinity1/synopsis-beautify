{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/synopsis/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/synopsis/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/synopsis/./src/common/extend.ts","webpack://@fof/synopsis/./src/forum/addSummaryExcerpt.tsx","webpack://@fof/synopsis/./src/forum/addUserPreference.ts","webpack://@fof/synopsis/./src/forum/components/Excerpt.tsx","webpack://@fof/synopsis/./src/forum/components/index.ts","webpack://@fof/synopsis/./src/forum/extend.ts","webpack://@fof/synopsis/./src/forum/index.ts","webpack://@fof/synopsis/./src/forum/utils/index.ts","webpack://@fof/synopsis/./src/forum/utils/truncateHtml.ts","webpack://@fof/synopsis/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/components/FieldSet']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/extenders']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['common/utils/string']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@fof/synopsis/external root \"flarum.core.compat['tags/common/models/Tag']\"","webpack://@fof/synopsis/webpack/bootstrap","webpack://@fof/synopsis/webpack/runtime/compat get default export","webpack://@fof/synopsis/webpack/runtime/define property getters","webpack://@fof/synopsis/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/synopsis/webpack/runtime/make namespace object"],"sourcesContent":["import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import Extend from 'flarum/common/extenders';\nimport Tag from 'flarum/tags/common/models/Tag';\n\nexport default [\n  new Extend.Model(Tag) //\n    .attribute<boolean>('richExcerpts')\n    .attribute<number>('excerptLength'),\n];\n","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport type Mithril from 'mithril';\nimport Excerpt from './components/Excerpt';\n\nexport default function addSummaryExcerpt() {\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\n    if (typeof params.include === 'string') {\n      params.include = [params.include];\n    } else {\n      params.include = params.include || [];\n    }\n\n    if (app.forum.attribute<string>('synopsis.excerpt_type') === 'first') {\n      params.include.push('firstPost');\n    } else {\n      params.include.push('lastPost');\n    }\n  });\n\n  extend(DiscussionListItem.prototype, 'infoItems', function (items: ItemList<Mithril.Children>) {\n    // Skip if we are searching to preserve most relevant post content as excerpt,\n    // that way we also preserve highlighting of search terms in the most relevant post.\n    // @ts-expect-error\n    if (app.forum.attribute('synopsis.disable_when_searching') && app.discussions.params.q) return;\n\n    const discussion = this.attrs.discussion;\n\n    if (app.session.user && !app.session.user.preferences()?.showSynopsisExcerpts) {\n      return;\n    }\n\n    const tags = discussion.tags();\n    let tag;\n    let disableSyno = false;\n    if (tags) {\n      for (const tagTemp of tags) {\n        if (tagTemp?.excerptLength() === 0) {\n          disableSyno = true;\n        }\n      }\n      tag = tags[tags.length - 1];\n    }\n\n    const excerptPost = app.forum.attribute<string>('synopsis.excerpt_type') === 'first' ? discussion.firstPost() : discussion.lastPost();\n    const excerptLength = typeof tag?.excerptLength() === 'number' ? tag?.excerptLength() : app.forum.attribute<number>('synopsis.excerpt_length');\n    const richExcerpt = typeof tag?.richExcerpts() === 'number' ? tag?.richExcerpts() : app.forum.attribute<boolean>('synopsis.rich_excerpts');\n    const onMobile = app.session.user ? app.session.user.preferences()?.showSynopsisExcerptsOnMobile : false;\n\n    // A length of zero means we don't want a synopsis for this discussion, so do nothing.\n    if (excerptLength === 0 || disableSyno) {\n      return;\n    }\n\n    if (excerptPost) {\n      const excerpt = <Excerpt post={excerptPost} length={excerptLength} richExcerpt={richExcerpt} />;\n\n      items.add('excerpt', excerpt, -100);\n      onMobile && items.add('excerptM', excerpt, -100);\n    }\n  });\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport SettingsPage from 'flarum/forum/components/SettingsPage';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Switch from 'flarum/common/components/Switch';\nimport Stream from 'flarum/common/utils/Stream';\nimport type Mithril from 'mithril';\n\nexport default function () {\n  extend(SettingsPage.prototype, 'oninit', function () {\n    this.showSynopsisExcerpts = Stream(this.user?.preferences()?.showSynopsisExcerpts);\n    this.showSynopsisExcerptsOnMobile = Stream(this.user?.preferences()?.showSynopsisExcerptsOnMobile);\n  });\n\n  extend(SettingsPage.prototype, 'settingsItems', function (items) {\n    items.add(\n      'synopsis',\n      FieldSet.component(\n        {\n          label: app.translator.trans('fof-synopsis.forum.user.settings.summaries-heading'),\n          className: 'Settings-Synopsis',\n        },\n        this.summariesItems().toArray()\n      )\n    );\n  });\n\n  SettingsPage.prototype['summariesItems'] = function () {\n    const items = new ItemList<Mithril.Children>();\n    if (!this.user) return items;\n\n    const prefs = this.user.preferences();\n\n    items.add(\n      'synopsis-excerpts',\n      Switch.component(\n        {\n          state: prefs?.showSynopsisExcerpts,\n          onchange: (value: boolean) => {\n            this.showSynopsisExcerptsLoading = true;\n\n            this.user?.savePreferences({ showSynopsisExcerpts: value }).then(() => {\n              this.showSynopsisExcerptsLoading = false;\n              m.redraw();\n            });\n          },\n          loading: this.showSynopsisExcerptsLoading,\n        },\n        app.translator.trans('fof-synopsis.forum.user.settings.show-summaries')\n      )\n    );\n\n    if (prefs?.showSynopsisExcerpts) {\n      items.add(\n        'synopsis-excerpts-mobile',\n        Switch.component(\n          {\n            state: prefs?.showSynopsisExcerptsOnMobile,\n            disabled: !prefs?.showSynopsisExcerpts,\n            onchange: (value: boolean) => {\n              this.showSynopsisExcerptsOnMobileLoading = true;\n\n              this.user?.savePreferences({ showSynopsisExcerptsOnMobile: value }).then(() => {\n                this.showSynopsisExcerptsOnMobileLoading = false;\n                window.location.reload();\n              });\n            },\n            loading: this.showSynopsisExcerptsOnMobileLoading,\n          },\n          app.translator.trans('fof-synopsis.forum.user.settings.show-summaries-mobile')\n        )\n      );\n    }\n\n    return items;\n  };\n}\n","import Component, { ComponentAttrs } from 'flarum/common/Component';\nimport Post from 'flarum/common/models/Post';\nimport { truncate } from 'flarum/common/utils/string';\nimport type Mithril from 'mithril';\nimport truncateHtml from '../utils/truncateHtml';\n\nexport interface ExcerptAttrs extends ComponentAttrs {\n  post: Post;\n  length: number;\n  richExcerpt: boolean;\n}\n\nexport default class Excerpt extends Component<ExcerptAttrs> {\n  post!: Post;\n  length!: number;\n  richExcerpt!: boolean;\n\n  oninit(vnode: Mithril.Vnode<ExcerptAttrs, this>) {\n    super.oninit(vnode);\n\n    this.post = this.attrs.post;\n    this.length = this.attrs.length;\n    this.richExcerpt = this.attrs.richExcerpt;\n  }\n\n  beautifyContent() {\n\n    function containsOnlySpecificChild(parent: HTMLElement, childSelector: string) {\n      const children = parent.childNodes;\n      let elementCount = 0;\n      let foundElement = null;\n      \n      if (!childSelector) {\n          if (!([\"p\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"].includes(parent.tagName.toLowerCase()))) {\n              return false;\n          } else {\n              return children.length ? false : true;\n          }\n      }\n  \n      for (let i = 0; i < children.length; i++) {\n          const node = children[i];\n          \n          if (node.nodeType === Node.ELEMENT_NODE) {\n              elementCount++;\n              if (elementCount > 1 || !(node as Element).matches(childSelector)) {\n                  return false;\n              }\n              foundElement = node;\n          }\n          else if (node.nodeType === Node.TEXT_NODE && (node.textContent || '').trim() !== '') {\n              return false;\n          }\n          else if (node.nodeType !== Node.TEXT_NODE) {\n              return false;\n          }\n      }\n      return elementCount === 1 && foundElement !== null;\n    }\n\n    function removeFirstChildBR(element: HTMLElement) {\n        /* Actually removes all unnecessary elements */\n        const children = element.childNodes;\n        let firstHandled = false;\n        let lastBr = false;\n        for (let i = 0; i < children.length; i++) {\n            const node = children[i];\n            if (node.nodeType === 8) {\n                continue;\n            }\n            \n            else if (node.nodeType === 3) {\n                if (!(((node.textContent || '').trim() == '') || ((node.textContent || '').trim() == '\\n'))) {\n                    console.log(node.textContent);\n                    firstHandled = true;\n                    lastBr = false;\n                    continue;\n                } else {\n                    continue;\n                }\n            } \n\n            else if (node.nodeType === 1) {\n                if (node.tagName.toLowerCase() == 'img' || node.firstChild?.tagName.toLowerCase() == 'img') {\n                    continue;\n                }\n                else if (node.tagName.toLowerCase() == 'br') {\n                    if (!firstHandled || lastBr) {\n                        element.removeChild(node);\n                        i--;\n                    }\n                    lastBr = true;\n                    continue;\n                }\n                else {\n                    firstHandled = true;\n                    lastBr = false;\n                    continue;\n                }\n            }\n        }\n        return;\n    }\n\n    let htmlContent = '';\n    let finalHtmlContent = '';\n    if (this.richExcerpt) {\n      htmlContent = truncateHtml(this.contentRich() ?? '', this.length);\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(htmlContent, \"text/html\");\n\n      const oneSynopsis = doc.body;\n      let richContext = null;\n      const directChildren = oneSynopsis.children;\n      if (directChildren.length == 1 && directChildren[0].children.length) {\n          richContext = false;\n      } else {\n          // poor context still breaks element when specials appear, like img\n          // get that out\n          for (let i = 0; i < directChildren.length - 1; i++) {\n              const directChildNotLast = directChildren[i];\n              if (directChildNotLast.children.length == 0) {\n                  richContext = true;\n                  break;\n              }\n          }\n      }\n      if (richContext) {\n        let imgCount = 0;\n        let nonImgCount = 0;\n        \n        let pending = [];\n        let pending2 = [];\n        \n        for (const directChild of directChildren) {\n            if (containsOnlySpecificChild(directChild, \"img\")) {\n                // so this is a pure picture child\n                imgCount += 1;\n                if (imgCount >= 4) {\n                    directChild.style.setProperty(\"display\", \"none\");\n                }\n                pending.push(directChild);\n            } else if (directChild.tagName.toLowerCase() == \"img\") {\n                imgCount += 1;\n                if (imgCount >= 4) {\n                    directChild.style.setProperty(\"display\", \"none\");\n                }\n                pending2.push(directChild);\n            } else {\n                nonImgCount += 1;\n                if (nonImgCount >= 4) {\n                    directChild.style.setProperty(\"display\", \"none\");\n                }\n            }\n        }\n        for (const pend of pending) {\n            oneSynopsis.appendChild(pend);\n        }\n        for (const pend2 of pending2) {\n            let imgWrapper = document.createElement(\"p\");\n            imgWrapper.appendChild(pend2);\n            oneSynopsis.appendChild(imgWrapper);\n        }\n      } else {\n        // ensured poor context\n        let imgCount = 0;\n        let nonImgCount = 0;\n        \n        let imgSets: any[] = [];\n        for (const directChild of directChildren) {\n            imgSets = imgSets.concat(directChild.querySelectorAll(\"img\"));\n            let brSet = directChild.querySelectorAll(\"br\");\n            for (let i = 2; i < brSet.length; i++) {\n                let removeBr = brSet[i];\n                removeBr.remove();\n            }\n            removeFirstChildBR(directChild);\n        }\n        \n        for (const imgs of imgSets) {\n            for (const img of imgs) {\n                imgCount += 1;\n                if (imgCount >= 4) {\n                    img.style.setProperty(\"display\", \"none\");\n                }\n                let imgWrapper = document.createElement(\"p\");\n                imgWrapper.appendChild(img);\n                oneSynopsis.appendChild(imgWrapper);\n            }\n        }\n        \n        nonImgCount = directChildren.length - imgCount\n        for (let i = 3; i < nonImgCount; i++) {\n            let nonDispChild = directChildren[i];\n            nonDispChild.style.setProperty(\"display\", \"none\");\n        }\n        \n        const clearEmpty = oneSynopsis.querySelectorAll(\"*\");\n        for (const ifEmpty of clearEmpty) {\n            if (containsOnlySpecificChild(ifEmpty, \"\")) {\n                ifEmpty.remove();\n            }\n        }\n      }\n      //console.log(oneSynopsis);\n      finalHtmlContent = oneSynopsis.innerHTML;\n    } else {\n      htmlContent = truncate(this.contentPlain() ?? '', this.length);\n      finalHtmlContent = htmlContent;\n    }\n    return finalHtmlContent;\n  }\n\n  view() {\n    return <div className=\"Synopsis-excerpt\">{this.getContent()}</div>;\n  }\n\n  getContent(): Mithril.Vnode | string {\n    if (this.richExcerpt) {\n      return m.trust(this.beautifyContent());\n    }\n\n    return truncate(this.contentPlain() ?? '', this.length);\n  }\n\n  contentRich() {\n    return this.post.contentHtml();\n  }\n\n  contentPlain() {\n    return this.post.contentPlain();\n  }\n}\n","import Excerpt from './Excerpt';\n\nexport const components = {\n  Excerpt,\n};\n","import Extend from 'flarum/common/extenders';\nimport commonExtend from '../common/extend';\n\nexport default [...commonExtend];\n","import app from 'flarum/forum/app';\nimport addSummaryExcerpt from './addSummaryExcerpt';\nimport addUserPreference from './addUserPreference';\n\nexport { default as extend } from './extend';\n\nexport * from './components';\nexport * from './utils';\n\napp.initializers.add('fof-synopsis', () => {\n  addSummaryExcerpt();\n  addUserPreference();\n});\n","import truncateHtml from './truncateHtml';\n\nexport const utils = {\n  truncateHtml,\n};\n","/**\n * Safely truncate an HTML string without breaking opening/closing tags\n * Only characters in text nodes count towards the length\n * @param html\n * @param length\n */\nexport default function (html: string, length: number): string {\n  const parser = new DOMParser().parseFromString(html, 'text/html');\n\n  // Safe HTML truncation\n  // Loop through every node and shorten text nodes once the length is reached\n  // After reaching the limit, start deleting other children we come across\n  const truncateNode = (node: Node) => {\n    if (length === 0) {\n      node.parentNode!.removeChild(node);\n      return;\n    }\n\n    if (node.nodeType === Node.TEXT_NODE) {\n      if (node.textContent!.length < length) {\n        length -= node.textContent!.length;\n      } else {\n        node.textContent = node.textContent!.substring(0, length) + '...';\n        length = 0;\n      }\n      return;\n    }\n\n    // Need to create copy of the node list otherwise the loop gets messed up when a node is deleted\n    Array.from(node.childNodes).forEach(truncateNode);\n  };\n\n  truncateNode(parser.body);\n\n  return parser.body.innerHTML;\n}\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/FieldSet'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/extenders'];","module.exports = flarum.core.compat['common/utils/ItemList'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['common/utils/string'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/DiscussionListItem'];","module.exports = flarum.core.compat['forum/components/SettingsPage'];","module.exports = flarum.core.compat['forum/states/DiscussionListState'];","module.exports = flarum.core.compat['tags/common/models/Tag'];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["setPrototypeOf","_inheritsLoose","t","o","prototype","Object","create","constructor","default","_setPrototypeOf","e","bind","__proto__","Extend","Tag","Model","attribute","extend","app","DiscussionListState","DiscussionListItem","Excerpt","addSummaryExcerpt","params","include","forum","push","items","_app$session$user$pre","_tag","_tag2","_tag3","_tag4","_app$session$user$pre2","discussions","q","discussion","attrs","session","user","preferences","showSynopsisExcerpts","tags","tag","disableSyno","_iterator","_createForOfIteratorHelperLoose","_step","done","tagTemp","value","excerptLength","length","excerptPost","firstPost","lastPost","richExcerpt","richExcerpts","onMobile","showSynopsisExcerptsOnMobile","excerpt","m","post","add","SettingsPage","FieldSet","ItemList","Switch","Stream","_this$user","_this$user2","component","label","translator","trans","className","summariesItems","toArray","_this","prefs","state","onchange","_this$user3","showSynopsisExcerptsLoading","savePreferences","then","redraw","loading","disabled","_this$user4","showSynopsisExcerptsOnMobileLoading","window","location","reload","Component","truncate","truncateHtml","_Component","_len","arguments","args","Array","_key","call","apply","concat","_proto","oninit","vnode","beautifyContent","containsOnlySpecificChild","parent","childSelector","children","childNodes","elementCount","foundElement","includes","tagName","toLowerCase","i","node","nodeType","Node","ELEMENT_NODE","matches","TEXT_NODE","textContent","trim","removeFirstChildBR","element","firstHandled","lastBr","console","log","_node$firstChild","firstChild","removeChild","htmlContent","finalHtmlContent","_this$contentRich","contentRich","parser","DOMParser","doc","parseFromString","oneSynopsis","body","richContext","directChildren","directChildNotLast","imgCount","nonImgCount","pending","pending2","directChild","style","setProperty","_i","_pending","pend","appendChild","_i2","_pending2","pend2","imgWrapper","document","createElement","imgSets","_iterator2","_step2","querySelectorAll","brSet","removeBr","remove","_iterator3","_step3","imgs","_iterator5","_step5","img","nonDispChild","clearEmpty","_iterator4","_step4","ifEmpty","innerHTML","_this$contentPlain","contentPlain","view","getContent","_this$contentPlain2","trust","contentHtml","components","commonExtend","addUserPreference","initializers","utils","html","truncateNode","parentNode","substring","from","forEach"],"sourceRoot":""}